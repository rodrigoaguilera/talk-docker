<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Docker y Drupal</title>

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/sky.css">

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="lib/css/zenburn.css">
    <style>
body .reveal section img {
  border: 0;
}
body .reveal pre {
  width: 99%;
}
body .reveal section h1, body .reveal section h2 {
  letter-spacing: 0;
}
    </style>

    <!-- Printing and PDF exports -->
    <script>
var link = document.createElement( 'link' );
link.rel = 'stylesheet';
link.type = 'text/css';
link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>
  </head>
  <body>
    <div class="reveal">
      <div class="slides">
        <section>
          <img src="images/Druplicon2015.png" alt="Druplicon" />
          <h2 style="color:red;">‚ô•</h2>
          <img src="images/docker-logo.png" alt="Docker" />
        </section>
        <section>
          <h1>Docker</h1>
          <h3>S√∫bete al barco de las herramientas de desarrollo est√°ndar üö¢</h3>
          <aside class="notes">
            La motivaci√≥n de esta charla dar a conocer nuestro recorrido <br />
            hacia una estandarizaci√≥n de las herramientas de desarrollo. <br />
            Queremos dar por solucionados problemas <br />
            del pasado para dedicarnos a nuevos problemas.
          </aside>
        </section>
        <section>
          <h1>Hola üëã</h1>
          <p class="fragment">
          <img src="images/ymbralogo.png" alt="Ymbra" width="250" style="border: 0">
          </p>

          <aside class="notes">
            Gracias a la AED, Ymbra <br />
            Diego se ha incorporado recientemente a Ymbra desde Sevilla <br />
            Tiene un verdadero inter√©s por la estandarizaci√≥n para que <br />
            los proyectos que realizamos sigan unos criterios definidos.  <br />
            Ambos teniamos un especial inter√©s en Docker por que nos ha facilitado mucho la vida. <br />
            Rodrigo es de Madrid y ahora vive y trabaja en Barcelona con Ymbra. <br />
            Lleve unos a√±os dando charlas sobre procesos de desarrollo y calidad <br />
            en temas como composer, revisi√≥n de c√≥digo, contenido por defecto  y testing con behat. <br />
            Siempre tiene curiosidad sobre como se puede mejorar o automatizar los procesos del d√≠a a d√≠a. <br />
          </aside>
        </section>
        <section>
          <h2>¬øQue tal vosotros?</h2>
          <aside class="notes">
            Quien tiene experiencia con docker? <br />
            Quien se dedica a la desarrollo? <br />
            Quien se dedica a ayudar a los desarrolladores a desplegar c√≥digo? <br />
          </aside>
        </section>
        <section>
          <section>
            <h1>Historia</h1>
            <p>¬øComo hemos llegado hasta aqui?</p>
            <aside class="notes">
            </aside>
          </section>
          <section>
            <h2>Servidores de desarrollo local</h2>
            <ul>
              <li>WAMP, XAMPP, MAMP, etc</li>
              <li>Gestores de paquetes: apt, rpm, brew (mac)</li>
            </ul>
            <aside class="notes">
              Habitualmente versiones fijas.
              Las herramientas de soporte tambi√©n estaban instaladas en la maquina <br />
              Ejemplos: drush, nodejs, ruby, php.
            </aside>
          </section>
          <section>
            <h2>Virtualizaci√≥n completa</h2>
            <ul>
              <li>Virtualbox, VMware, KVM</li>
              <li>Gestores de virtualizaci√≥n: vagrant</li>
            </ul>
            <aside class="notes">
            </aside>
          </section>
          <section>
            <h2>Otros gestores de virtualizaci√≥n ligera</h2>
            <ul>
              <li>LXC</li>
              <li>chroot</li>
            </ul>
            <aside class="notes">
              Docker va m√°s proporcionando un ecosistema: <br />
              Dockerfile, red, volumenes, API, etc.
            </aside>
          </section>
        </section>
        <section>
          <section>
            <h1>Docker üêã</h1>
            <aside class="notes">
              Virtualizaci√≥n ligera a nivel de sistema operativo. <br />
              Aisla procesos de manera que cada uno tiene su red, <br />
              conjunto de usuarios y sistemas de ficheros gracias a <br />
              tecnologias de Linux como namespaces o cgroups. <br />
            </aside>
          </section>
          <section>
            <h1>Historia</h1>
            <ul>
              <li>Comienza como un gestor de LXC</li>
              <li>Reescritura en Go separando componentes y creando una API REST</li>
            </ul>
            <aside class="notes">
              Principal adopci√≥n como herramienta de desarrollo <br />
              Cada vez m√°s se empuja en entornos de producci√≥n
            </aside>
          </section>
          <section>
            <h2>Virtualizaci√≥n ligera üöà</h2>
            <aside class="notes">
              Arrancar y parar es muy r√°pido. <br />
              Multiples instancias de una misma imag√©n comparten sistema de ficheros <br />
              hasta que tienen que escribir algo distinto en ellos. <br />
              Debido a esto el nivel de aislamiento no es completo <br />
              y hay precauciones de seguridad que tomar (usuario root).
            </aside>
          </section>
          <section>
            <h2>Contenedores üì¶</h2>
            <aside class="notes">
              Para muchos puede suponer un cambio de paradigma  <br />
              porque usa una "maquina virtual" por cada herramienta que usamos: <br />
              php, servidor, web, varias bases de datos.
            </aside>
          </section>
          <section>
            <h2>Im√°genes y contenedores</h2>
            <aside class="notes">
              Analogia con orientaci√≥n a objetos: clase e instancia. <br />
              La imagen es la plantilla base y el contenedor es lo que realmente se ejecuta.
            </aside>
          </section>
          <section>
            <h2>Docker multiplataforma</h2>
            <p>Mac y windows</p>
            <aside class="notes">
              Es una tecnologia solo disponible en linux. <br />
              Se crean maquinas virtuales transparentes con un peque√±o coste de rendimiento <br />
              Retos a la hora de compartir ficheros entre linux y el sistema operativo anfitri√≥n.
            </aside>
          </section>
        </section>
        <section>
          <section>
            <h2>Manos a la obra con docker</h2>
            <p>Como empezar a desenvolverse con los comandos</p>
            <aside class="notes">
            </aside>
          </section>
          <section>
            <h2>Instalar docker</h2>
            <p>Community edition</p>
            <ul>
              <li>Linux: a√±adir repos oficiales y <pre>apt install docker-ce </pre></li>
              <li>Mac: Descargar de la web o <pre> brew cask install docker </pre></li>
              <li>Windows: descargar instalador</li>
            </ul>
            <aside class="notes">
              Todos los casos necesitan privilegios elevados. <br />
              En linux es posible que tengas que a√±adir a tu usuario al grupo "docker" <br />
            </aside>
          </section>
          <section>
            <h2>Hola mundo</h2>
            <pre>
              docker run hello-world
            </pre>
            <aside class="notes">
              El cliente hace una petici√≥n al demonio <br />
              Se descarga una imagen de un repositorio <br />
              Una instancia de esa imagen es creada <br />
              Se ejecuta el binario por defecto de esa imagen <br />
              La salida del comando se envia a la terminal
            </aside>
          </section>
          <section>
            <h2>Un paso m√°s all√°</h2>
            <pre>
              docker run -it debian bash
            </pre>
            <img src="images/docker-run-fresh.png" alt="Docker run" />
            <aside class="notes">
              Sesi√≥n interactiva dentro del contenedor. <br />
              Comienzo desde un sistema limpio
            </aside>
          </section>
          <section>
            <h2>Instalar servidor</h2>
            <pre><code data-trim data-noescape>
              apt update
              apt install apache2 mysql-server php
              service start mysql
              service start apache
            </code></pre>
            <aside class="notes">
            </aside>
          </section>
          <section>
            <img src="images/lady.jpg" alt="Old lady at computer" />
            <aside class="notes">
            </aside>
          </section>
          <section>
            <h2>Abrir puertos ‚öì</h2>
            <pre><code data-trim data-noescape>
              docker run -it -p 80:80 debian bash
            </code></pre>
            <aside class="notes">
            </aside>
          </section>
          <section>
            <h1>üóø</h1>
            <h2>El contenedor monol√≠tico</h2>
            <aside class="notes">
              Lo que acabamos de construir no es lo m√°s correcto <br />
              pero es intuitivo <br />
            </aside>
          </section>
          <section>
            <h2>El contenedor para cada servicio</h2>
            <p>Cada proceso separado en su propio contenedor</p>
            <pre><code data-trim data-noescape>
              docker run -p 80:80 php:apache
              docker run mysql
            </code></pre>
            <aside class="notes">
            </aside>
          </section>
          <section>
            <h2>Cocinar nuestras propias im√°genes üç≤</h2>
            <p>Dockerfile</p>

            <pre><code data-trim data-noescape>
FROM debian
RUN apt update && apt install apache2 php php-gd
RUN a2enmod rewrite
RUN curl https://getcomposer.org/download/1.6.3/composer.phar \
> /usr/local/bin/composer && \
chmod 755 /usr/local/bin/composer
COPY php.ini /usr/local/etc/php/php.ini
CMD ["apachectl", "-DFOREGROUND"]
            </code></pre>
            <aside class="notes">
            No se est√° limpiando la cach√© <br />
            </aside>
          </section>
          <section>
            <h2>Construir la imagen üîß</h2>
            <pre><code data-trim data-noescape>
              docker build -t ymbra/myapache .
              docker run -p 80:80 ymbra/myapache
            </code></pre>
            <aside class="notes">
              El punto indica que se tiene que construir el directorio actual. <br />
              Es necesario tener un php.ini en el mismo directorio <br />
            </aside>
          </section>
          <section>
            <h2>Repositorios de im√°genes</h2>
            <p>https://hub.docker.com/</p>
            <pre><code data-trim data-noescape>
              docker push ymbra/myapache
            </code></pre>
            <aside class="notes">
            </aside>
          </section>
          <section>
            <h2>Im√°genes por y para la comunidad</h2>
            <p>Docker4Drupal</p>
            <p>Preparadas para usar directamente</p>
            <ul>
              <li>PHP con Drupal 6,7,8</li>
              <li>MariaDB</li>
              <li>Redis</li>
              <li>Varnish</li>
              <li>Solr</li>
              <li>Etc..</li>
            </ul>
            <aside class="notes">
              Se pueden configurar para activar XDebug y otras herramientas. <br />
            </aside>
          </section>
          <section>
            <h2>Persistencia de datos: vol√∫menes</h2>
            <pre><code data-trim data-noescape>
docker run -v "$PWD":/var/www/html/ -p 80:80 php:apache
docker run -v files:/var/www/html/sites/default/files -p 80:80 php:apache
docker run -v database:/var/lib/mysql mariadb
            </code></pre>
            <aside class="notes">
              Usar un repositorio de un proyecto y ejecutarlo dentro del contenedor. <br />
              Quiero destruir el contenedor a menudo <br />
              El contenedor como un proceso <br />
            </aside>
          </section>
          <section>
            <h2>Coordinaci√≥n entre contenedores</h2>
            <img src="images/docker-compose.png" alt="Docker compose logo" />
            <aside class="notes">
              Sirve para definir los contenedores que voy a usar <br />
              y lanzarlos todos de una sola vez. <br />
            </aside>
          </section>
          <section>
            <h2>docker-compose.yml</h2>
            <pre><code data-trim data-noescape>
version: "3.4"
services:
  web:
    image: ymbra/drupal
    volumes:
      - .:/var/www
    ports:
      - "80:80"
  db:
    image: mariadb:10.2
    environment:
      MYSQL_USER: db
      MYSQL_PASSWORD: db
      MYSQL_DATABASE: db
      MYSQL_ROOT_PASSWORD: db
            </code></pre>
            <aside class="notes">
            </aside>
          </section>
          <section>
            <h2>comandos docker compose</h2>
            <pre><code data-trim data-noescape>
docker-compose up
docker-compose down
docker-compose exec <SERVICIO> <COMANDO>
# Por ejemplo:
docker-compose exec web bash
docker-compose exec web composer install
            </code></pre>
            <aside class="notes">
              Levantar todos los contenedores <br />
              Se queda el terminal imprimiendo logs<br />
              Destruir todos los contenedores, volumenes y redes <br />
            </aside>
          </section>
          <section>
            <h2>A√±adir nuevos servicios a docker-compose.yml</h2>
            <p>PHPMyAdmin</p>
            <pre><code data-trim data-noescape>
services:
  ...
  pma:
    image: phpmyadmin/phpmyadmin
    environment:
      PMA_HOSTS: "db"
      PMA_USER: db
      PMA_PASSWORD: db
    ports:
      - "8080:80"
            </code></pre>
            <aside class="notes">
            </aside>
          </section>
          <section>
            <h2>A√±adir nuevos servicios a docker-compose.yml</h2>
            <p>Mailhog</p>
            <pre><code data-trim data-noescape>
services:
  ...
  web:
   ...
  mailhog:
    image: mailhog/mailhog
    ports:
      - "8025:8025"
            </code></pre>
            <aside class="notes">
              Servidor smtp para evitar el envio real de mails. <br />
            </aside>
          </section>
        </section>
        <section>
          <section>
            <h2>Trabajo en equipo</h2>
            <img src="images/emoji-team.jpg" alt="Nudge emojis" style="width:60%;" />
            <aside class="notes">
            </aside>
          </section>
          <section>
            <h2>Entornos definidos en c√≥digo</h2>
            <ul>
              <li>Versiones concretas para todos los desarrolladores</li>
              <li>Tus mejoras son mejoras para todos</li>
              <li>Abstracci√≥n sobre complejidades</li>
            </ul>
            <aside class="notes">
              Funciona en mi entorno local! <br />
              A√±adir nuevos servicios, subir versiones sin que se rompa <br />
              Por ejemplo si el deploy requiere una vpn, se puede dejar configurada <br />
            </aside>
          </section>
          <section>
            <h2>Desechable y ligero üöÆ</h2>
            <ul>
              <li>Nuevas incorporaciones al equipo</li>
              <li>Cambio de port√°til</li>
              <li>Inicio desde cero r√°pido y sencillo</li>
            </ul>
            <aside class="notes">
              Otras soluciones tardan hasta 15 minutos solo en provisionar la m√°quina. <br />
            </aside>
          </section>
        </section>
        <section>
          <section>
            <h2>Errores comunes y buenas practicas</h2>
            <img src="images/experience.gif" alt="Captain.gif" style="width:60%;" />
            <aside class="notes">
            </aside>
          </section>
          <section>
            <h2>Rendimiento</h2>
            <p>Compartir ficheros entre el huesped y el contenedor</p>
            <ul>
              <li>Linux: no sufre penalizaci√≥n</li>
              <li>
                Mac: flags para volumenes

            <pre><code data-trim data-noescape>
            docker run -v /Users/ymbra/app:/app:delegated drupal
            </code></pre>
              </li>
              <li>Mac y windows: docker-sync</li>
            </ul>
            <aside class="notes">
              Docker sync usa unison para sincronizar ficheros y directorios. <br />
              Es un sistema delicado sobre todo por temas de eventos.
            </aside>
          </section>
          <section>
            <h2>Permisos y propietarios</h2>
            <p>ficheros con UIDs distintas al usuario huesped</p>
            <ul>
              <li>Mac y windows: sin problemas. mapeado al usuario del huesped</li>
              <li> Linux:
                <ul>
                  <li>
                    Modificar huesped para tener permisos sobre otros usuarios
                  </li>
                  <li>
                    Modificar im√°genes para que acepten UID como una variable de entorno.
                  </li>
                </ul>
              </li>
            </ul>
            <aside class="notes">
              Tambien ocurre viceversa <br />
              Los contenedores se ejecutan con UIDs arbitrarias. <br />
            </aside>
          </section>
          <section>
            <h2>Un contenedor por componente/herramienta</h2>
            <aside class="notes">
              Servidor web y php en servidores distintos. <br />
              Nodejs es aceptable si solo es por cuestiones de desarrollo. <br />
              Drush por ejemplo no tiene sentido separarlo <br />
            </aside>
          </section>
          <section>
            <h2>Documentar la responsabilidad de cada contenedor</h2>
            <ul>
              <li>¬øQue contenedor se usa para drush/composer?</li>
              <li>¬øComo importo un volcado de base de datos?</li>
              <li>¬øComo activo XDebug?</li>
            </ul>
            <aside class="notes">
            </aside>
          </section>
          <section>
            <h2>Subir im√°genes al repositorio</h2>
            <p>En vez de a√±adir un Dockerfile a tu proyecto</p>
            <ul>
              <li>Otros compa√±eros se ahorran la compilaci√≥n</li>
              <li>Reusabilidad en otros proyectos</li>
              <li>Ayuda a contruir im√°genes m√°s simples y configurables</li>
            </ul>
            <aside class="notes">
              Descarga de la la im√°gen ya compilada. <br />
              Varios proyectos pueden usar la misma im√°gen <br />
              No es aconsejable alamacenar secretos en la imagen. <br />
            </aside>
          </section>
        </section>
        <section>
          <section>
            <h2>Herramientas alrededor de docker</h2>
            <p>A√±aden funcionalidad por encima de docker</p>
            <aside class="notes">
            </aside>
          </section>
        </section>
      </div>
    </div>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.js"></script>

    <script>
// More info about config & dependencies:
// - https://github.com/hakimel/reveal.js#configuration
// - https://github.com/hakimel/reveal.js#dependencies
Reveal.initialize({
  dependencies: [
  { src: 'plugin/markdown/marked.js' },
  { src: 'plugin/markdown/markdown.js' },
  { src: 'plugin/notes/notes.js', async: true },
  { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
  ]
});
    </script>
  </body>
</html>
